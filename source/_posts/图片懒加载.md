---
title: 图片懒加载
date: 2021-11-13 17:24:59
tags:
---

懒加载其实就是延迟加载，主要的目的是对服务器前端的优化，减少请求次数或延迟请求次数  
浏览器可视区域是有限的，有些图片并不在可视区域内，就没有必要立马加载这些图片  
为实现懒加载，需要使用自定义属性`data-*`将图片的`src`替换成`data-src`，浏览器碰到自定义属性不会像碰到默认属性一样去处理的  
```html
    <img data-src="https://images.wallpaperscraft.com/image/single/cat_winter_fluffy_snow_99366_240x320.jpg" alt="pic">
```
通过scroll事件监听，页面的滚动  
但首先我们需要获取两个高度，分别是：
1. 浏览器可视区的高度 `window.innerHeight` or `document.documentElement.clientHeight`
2. 图片到视口上边的高度 `getBoundingClientRect().top`  

![pic](./图片懒加载/图片懒加载.png)  

如果图片可以看见，即图片到视口上边的高度**小于**浏览器可视区的高度  
```js
    const imgs = document.querySelectorAll('img')//获取图片
    window.addEventListener('scroll',(e)=>{
        imgs.forEach(item=>{
            const imgTop = item.getBoundingClientRect().top
            if(imgTop<window.innerHeight){//可以看见,将data-src内容赋给src
                const dataSrc = item.getAttribute('data-src')
                item.setAttribute('src',dataSrc)
            }
        })
    })
```
